# 연관성의 측도 {#association}

## 필요한 패키지

```{r}
#| warning: false
#| output: false
#| message: false
#| results: hide
library(tidyverse)
library(ggplot2)
library(epiR)
library(faraway)
```


## 이항변수 

통계학에서 관측값은 값이 가지는 특성에 따라서 연속형 변수(continuous variable)과 범주형 변수(categorical variable)로 나눈다.

결과가 2개인 범주형 변수인 이항변수(binary variable)는  매우 중요한 역할을 한다.
그 이유는 두 개의 선택 중에서 하나를 선택해 야할 의사결정이 실제로 대부분을 차지하고 있기 때문이다. 

예를 들어서 코로나 19에 감염된 환자가 병원에서 치료를 받고 있다고 가정해보자. 환자는 병원에서 여러 가지 검사를 수행하면서 다양한 자료를 수집한다.  예를 들어 환자는 수시로 체온을 재고 항체검사, 혈액검사 등을 받을 것이다. 다양한 검사 등에서 나온 자료는 연속형 또는 범주형 자료로 구성될 것이다.

하지만 의사가 가장 중요하게 결정할 사항은 환자가 계속 치료를 필요로 하는지 아닌지 결정해야 한다. 즉, 여러 가지 검사를 고려하여  최종적으로 의사는 환자가 더 치료가 필요한지 아닌 지를 결정해야 한다. 의사의 결정을 이항변수 $Y$로 다음과 같이 표현할 수 있다.. 

$$ 
Y = 
\begin{cases} 
1 & \text{ if patient still needs treatment} \\
0 & \text{ if patient dose not need treatment any more (GO HOME!)}
\end{cases}
$$

실제 임상에서는 이러한 두 개의 가능한 선택 중에 하나를 선택하는 결정이 빈번하게 일어나며 이러한 결정은 대부분 중요한 임상적 결정이다. 예를 들어 다음과 같은 의사결정들은 이항변수로 표현할 수 있다.

- 환자는 약을 복용해야 하는가?
- 환자는 입원을 해야 하는가?
- 환자는 중환자실로 가야 하는가?
- 환자는 퇴원해도 되는가? 

또는 환자의 상태(outcome)가 이항변수로 표현될 수 있다.  

- 환자는 치료가 되었는가?
- 환자가 사망하였는가?



이제 코로나 19 치료제의 효과를 알아보기 위한 임상실험을 수행하는 경우를 생각해보자. 통상적으로  임상실험에서는 두 개의 집단을 비교하며 가장 많이 사용하는 두 개의 집단은 실제 치료(drug)를 받은 사람들과 위약(placebo)을 받은 사람들이다. 즉 치료를 받은 사람과 받지 않는 사람들의 효과를 비교하는 것이 임상실험의 목적이다. 이러한 경우 앞에서 논의한 의사 결정과 마찬가지로 한 환자가 받은 치료의 종류를 이항변수 $X$로 나타낼 수 있다. 


$$ 
X= 
\begin{cases} 
1 & \text{ if patient receives drug} \\
0 & \text{ if treatment receives placebo}
\end{cases}
$$


## 분할표와 연관성의 측도   



### 분할표  

이제 앞에서 말한 두 개의 변수 $X$ 와 $Y$ 의 관계에 대해서 생각해 보자. 실험에서 사람들은 코로나 19에 대한 치료약의 효과에 관심이 있다. 코로나 19 환자가 치료약을 처치 받으면 치료약을 이용하지 않는 환자보다 빨리 치료되거나 사망할 가능성이 낮은 지가 주요 관심사이다. 즉, 치료약이 환자의 회복 속도나 사망과 연관(association)이 있는지 알고 싶은 것이며, 특히 실험이 매우 정교하게 설계된 경우는  치료약이 환자의 회복이나 사망에 영향을 미치는 원인이 되는지(cause-effect relation) 파악하고 싶은 것이다.       


 - 먼저 코로나 19에 대한 치료약의 효과에 대한 임상실험에  $n$ 명의 환자들이 실험에 참가 했다고 가정하자. 
 - 치료약이 효과가 있는지에 대한 결과($Y$)는 치료를 시작하여 정해진 기간 내에 사망하였는지에 대한 사건으로 결정하였다.
 
 
$$ 
Y = 
\begin{cases} 
1 & \text{ if patient is dead within D days } \\
0 & \text{ otherwise}
\end{cases}
$$


코로나 19에 대한 치료약의 효과에 대한 임상실험의 결과를 다음과 같은 **분할표(contingency table)**로 요약할 수 있다.


|치료/결과  |  사망 ($Y=1$) |   생존 ($Y=0$)   | 합계 | 
|:---------------:|:---------:|:-----------:|:-------:|
|위약 ($X=0$) | $n_{11}$ | $n_{12}$  |  $n_{1+}$ | 
| 치료약 ($X=1$)  |  $n_{21}$ | $n_{22}$  |  $n_{2+}$ |  
| 합계 | $n_{+1}$ | $n_{+2}$ | $n$ | 
 
: $2 \times 2$ 분할표  {#tbl-conttable22}

많은 임상실험이나 의학연구의 결과들을 위와 같은 $2 \times 2$ 분할표로 요약할 수 있다.
이제 우리의 관심은 분할표를 통해서 임상실험의 결과를 어떻게 통계적으로 추론할 수 있는지이다. 

::: {.callout-note}
분할표에서 연관성의 측도를 계산하는 경우 성공의 기준(이항변수로 표현하면 $Y=1$)에 따라서 계산을 수행해야 한다. 어떤 경우는 사망이나 악화와 같은 위험한 사건이 성공 사건이 될 수 있으며 어떤 경우는 생존이나 회복과 같은 좋은 사건이 성공이 될 수 있다. 

또한 기준이 되는 그룹(이항변수 $X$)에 따라서 연관성의 측도 계산할 때 분자와 분모에 해당하는 그룹을 적절하게  선택해야 한다.   

분할표에서 연관성의 측도를 계산하는 경우 분석의 의도와 목적에 맞게 성공 사건과 기준그룹을  정의하고 그에 따라서 연관성의 측도를 계산해야 한다.
:::



### 상대위험

$2 \times 2$ 분할표 @tbl-conttable22 에서 두 개의 처리군, 즉 치료약을 받은 집단과 위약을 받은 집단의 효과를 비교할 때 가장 많이 사용되는 측도(measure)는 **상대위험(relative risk, risk ratio, prevalnce ratio;RR)**이다.

주어진 집단의 위험율을 그 집단에 속한 환자의 수에서 사망한 사람의 비율이다. 분할표 @tbl-conttable22  에서 위약 집단의 위험율은 $n_{11}/n_{1+}$ 이며 이는 치료를 받지 않는 경우에 나타나는 기준점인 위험율(baseline risk)을 의미한다. 치료약 집단의 위험율은 $n_{21}/n_{2+}$ 이다. 통상적으로 위험율은 비율(proportion, percent)로 나타내며 
발생률(rate,예를 들어 인구 1000명당 X명)로 나타내기도 한다.

상대위험은 두 위험율의 비율로서 다음과 같이 정의한다.

\begin{equation}
RR = \frac{n_{11}/n_{1+}}{n_{21}/n_{2+}} = \frac{ \tfrac{n_{11}}{n_{11} + n_{12}}} { \tfrac{n_{21}}{n_{21} + n_{22}}}
\end{equation}

상대위험이 1보다 크면 분자에 위치한 집단이 위험(위의 예제에서는 위험이 사망을 의미한다)에 처할 가능성이 분모에 위치한 집단보다 $RR$ 배 높다는 것을 의미한다. 상대위험이 1이면 두 집단에 대한 위험이 동일하다는 것을 의미한다.  


예를 들어 특정한 코로나 치료제의 효과를 실험하는 임상실험에서 다음과 결과를 얻었다. 


|치료/결과  | 사망 ($Y=1$)    | 생존 ($Y=0$)   | 합계 | 
|:---------------:|:---------:|:-----------:|:-------:|
|위약 ($X=0$) |$10$  |  $1212$   |  $1222$ | 
| 치료약 ($X=1$)  | $5$ |  $2355$   |  $2360$ |  
| 합계 | $15$  |  $3567$ | $3582$ | 

: 코로나 치료제 실험 결과 {#tbl-conttable23}  

상대위험은 다음과 같이 계산된다.

$$ RR = \frac{10/1222}{5/2360} = 3.8625 \approx 4 $$
  
상대위험이  약 4 배란 의미는 치료약을 받은 집단보다 위약집단이 사망할 가능성이 약 4배 높다는 것이다.

::: {.callout-note}
우리는 두 집단의 비율을 비교할 때 두 비율의 차이를 이용하는 방법을 자주 사용한다.
두 집단의 비율이 각각 $p_1$, $p_2$ 라면 두 비율의 차이는 $p_1 - p_2$ 이며 
이는 우리가 평상 적으로 사용하는 비율의 비교 측도이다. 

예를 들어 대통령 후보들의 지지율과 차이는 많은 언론에서 사용하고 있으며 기초 통계학에서 
두 모집단의 비교를 위한 가설 검정에서도 비율의 차이를 이용하였다.  

위의 코로나 치료제의 효과를 비교하는 실험에서 치료집단과 위약집단의 사망률 차이를 측도로   사용하면 어떨까?
:::  



### 기여위험과 백신효과 

**기여위험(attributable proportion, attributable risk percent, AR)**은 두 그룹의 위험에 대한 비교를 위한 다른 측도이다. 기여위험은 특정한 성격을 가진 집단(exposed group)이 위험에 처한 전체 집단에서 차지하는 비율을 백분율로 나타낸다. 


\begin{equation}
AR = \frac{ (n_{11}/n_{1+}) - (n_{21}/n_{2+})} {n_{11}/n_{1+} } \times 100
\end{equation}


예를 들어 비흡연자(unexposed group)와 흡연자(exposed group)의 폐암에 대한 위험을 비교하는 경우를 생각해 보자.비흡연자의 폐암으로 인한 사망률이 연간 1000명 당 0.07명이고 흡연자는 1000명당 0.57명이라고 하면 

일단 상대위험은 약 8배이다.

$$  RR = 0.57/0.07 = 8.1428 $$

두 집단의 비교를 기여위험으로 나타내면 다음과 같다.



$$ AR = \frac{0.57-0.07}{0.57} \times (100) = 87.7\% \approx 88 \%$$

만약 흡연이 폐암을 일으키는 원인이고 두 집단의 다른 요인이 유사하다고 가정하면, 기여위험이 약 88\% 라는 것은 모든 폐암 환자(위험에 처한 전체 집단)의 88% 가 흡연에 의한 것이라고 해석할 수 있다.


최근에 코로나 19에 대한 백신과 치료제의 임상실험에서 효과를 발표하는 경우 
위에서 언급한 상대위험을 사용하지 않고 **백신효과(Vaccine efficacy, vaccine effectiveness; VE)** 라는 백분율을 사용한다.  백신효과는 기본적으로 기여위험과 동일한 측도이다.  


예를 들어 위의 예제에서 치료제의 효과를 백신효과(VE)로 계산하면 다음과 같다. 

$$ VE = \left [ \frac{10/1222 - 5/2360}{10/1222} \right ]\times 100 =74.1101\% $$

백신효과가 74\% 란 의미는 치료제를 사용하면 사용하지 않는 경우보다 사망을 74\% 줄일 수 있다고 해석할 수 있다.  

간단한 예로서 코로나19로 인한 치명율(사망자/확진자)을 비교한다고 가정하자. 백신을 맞은 그룹의 치명율이 1\%이고 백신을 맞지 않는 그룹의 치명율이 2\% 백신효과는 50\%이다.  


### 오즈비 

오드(odd)는 가능성을 나타내는 측도로서 전통적으로 도박에서 유래된 측도이다. 

우리가 주사위를 던져서 1과 2가나오면 성공, 다른 숫자가 나오면 실패라고 하는 경우 성공의 확률은 $2/6 =0.3333$ 으로 계산한다. 확률을 계산하는 경우는 분모에 전체 사건의 수를 사용한다.

위의 주사위 예제로 오드를 계산하면  $2/4 =0.5$ 가 된다. 즉, 오드는 분모에 성공을 제외한 실패의 사건을 수를 사용한다. 만약 오드가 1이면 무슨 의미인가? 오드가 1이면 성공하는 사건의 수가 실패하는 사건의 수가 동일하다는 의미이다. 게임에서 이길 확률이 $1/2$ 이면 공정한 게임이며 이 경우 오드는 1 이다. 

전통적으로 오드는 확률의 개념이 나오기 전에 가능성의 측도로 오랫동안 사용되어 왔으며 도박에서 상대방이 1번 이길 때 내가 이기는 평균적인 횟수를 의미한다.    

$$ odd = \frac{\text{number of events for success}}{\text{number of events for failure}} $$

예를 들어 위의 코로나 치료제 실험에서 성공을 사망할 사건이라고 하면 위약군의 오드는 $n_{11}/n_{12} =10/1212$ 이고 치료군의 오드는 $n_{21}/n_{22} = 5/2355$ 이다.


두 집단을 비교하는 측도 중 하나는 **오즈비(odds ratio; OR)**가 있다. 오즈비는  두 그룹의 오드들의 비율로 정의된다. 오즈비가 1이면 두 그룹에서 성공 사건의 가능성이 같다는 것이다. 


$$ OR = \frac{n_{11}/n_{12}}{n_{21}/n_{22}} = \frac{n_{11} n_{22}}{n_{12} n_{21}} $$ 




코로나 치료제 실험에서의 오즈비는 $(10/1212)/(5/2355) =3.8861$ 이다. 

오즈비는 상대위험이나 기여위험에 비하여 의미 있는 해석이 어렵다. 오즈비가 1이면 두 집단이 
성공의 가능성이 같다(또는 두 요인의 연관성이 없다)는 것으로 해석이 쉽다. 하지만 예를 들어 오즈비가 1 보다 큰 경우(또는 작은 경우) 두 집단의 차이를 의미 있게 해석하는 것이 어렵다.


오즈비는 향후 학습할 통계적 가설검정에서 중요한 모수(parameter)로 사용되며 특히 실험의 
방법이 사례-대조 연구와 같은 특별한 방법을 사용하는 경우 오즈비가 중요한 역할을 하게 된다.

---


예를 들어  다음과 같은 분할표에서 비율의 차이, 상대위험, 오즈비를 구하여 비교해 보자. 

|처리 /결과  |  성공  ($Y=1$) |   실패 ($Y=0$)    | 합계 | 
|:---------------:|:---------:|:-----------:|:-------:|
|  0 ($X=0$) | $6$ |   $4$  |  $10$ | 
| 1 ($X=1$)  | $4$|   $6$  |  $10$ |  
| 합계 | $10$ | $10$  | $20$ | 
:  $2 \times 2$ 분할표 예제  {#tbl-conttable24}


비율의 차이(DP)은 다음과 같이 계산된다.

$$ DP(0/1) =  6/10 - 4/10 = 0.2 $$

상대위험은 다음과 같이 계산된다.

$$ RR(0/1) = \frac{6/10}{4/10} = \frac{6}{4} = 1.5 $$


오즈비는 다음과 같이 계산된다.

$$ OR(0/1) = \frac{6/4}{4/6} = \frac{(6)(6)}{(4)(4)} = 2.25 $$

## 신뢰구간 

상대위험과 오즈비는 분할표에서 연관성을 나타내는 하나의 측도, 즉 점추정량(point estimation)
이다. 하나의 숫자로 표현되는 점추정은 표본으로 부터 발생한 불확실성을 반영하지 못한다. 따라서 점추정량을 보완하기 위하여 신뢰구간(confidence interval)을 제시할 수 있다.

상대위험과 오즈비는 표본비율 또는 셀 도수의 함수로 나타난다. 하지만 함수의 형태가 비율로서 비선형이기 때문에 상대위험과 오즈비의 근사적인 표준오차(standard error)는 쉽게 구할 수 없다.

다항분포를 가정하고 로그 오즈비의 점근적 분산을 다음과 같이 유도할 수 있다.

$$ v_1 =V ( \log OR)   \approx \frac{1}{n_{11}} + \frac{1}{n_{12}} + \frac{1}{n_{21}} + \frac{1}{n_{22}} $$

따라서 로그 오즈비의 $100(1-\alpha)$ \% 근사 신뢰구간을 다음과 같이 구할 수 있다.

\begin{equation*}
   \log OR \pm z_{\alpha/2} \sqrt{v_1}
\end{equation*} 

위의 신뢰구간을 오즈비로 역변환하면 오즈비 $OR$ 의 $100(1-\alpha)$ \% 근사 신뢰구간을 다음과 같다.


$$
   ( OR \times \exp [ - z_{\alpha/2} \sqrt{v_1}], ~~OR \times \exp [  z_{\alpha/2} \sqrt{v_1}] )
$$ {#eq-oddratiovar}   


상대위험(RR)의 신뢰구간도 오즈비의 신뢰구간을 유도하는 방법과 유사하게 델타 방법을 사용하며 다음과 같이 구할 수 있다.


$$
   ( RR \times \exp [ - z_{\alpha/2} \sqrt{v_2}], ~~OR \times \exp [  z_{\alpha/2} \sqrt{v_2}] )
$$  {#eq-rrratiovar}   

위의 식 @eq-rrratiovar 에서 $v_2$ 는 다음과 같이 계산한다.


$$ v_2 =V ( \log RR)   \approx \frac{1-n_{11}/n_{1+}}{n_{11}} + \frac{1-n_{21}/n_{2+}}{n_{21}} $$

### 예제: 아스피린 임상실험

소량의 아스피린 복용이 심장병으로 인한 위험을 줄이는데 효과가 있는지 알아보고자 임상실험을 실시하였다. 22,701명의 남성을 **임의화(randomization)** 을 통해서 두 그룹으로 나눈 후, 한 그룹은 매일 일정량의 아스피린을 복용시키고 다른 그룹은 위약(palcebo)를 복용하게 한 후 약 5년간 심근경색이 일어나는지 알아보았다. 임상실험의 결과는 아래 표와 같다.


|  |  심근경색 발생 |   심근경색 없음    | 합 | 
|:---------------:|:---------:|:-----------:|:-------:|
|  아스피린  | $139$ |   $10,898$  |  $11,037$ | 
|  위약  | $239$|   $10,795$  |  $11,034$ |  

: 아스피린 임상실험 결과 {#tbl-conttable25}


위약 집단과 아스피린 집단의 상대위험은 다음과 같다.

$$ RR = \frac{139/11037}{239/11034} = 0.581 $$

상대위험을 보면 1보다 작으므로 아스피린을 복용한 집단이 위약 집단에 비해서 심근 경색이 일어날 위험이 적어진 다는 것을 알 수 있다.

상대위험의 95\% 근사 신뢰구간은 다음과 같이 계산한다.

먼저 다음 $v_2$ 를 계산하면  

$$ v_2 = \frac{1-n_{11}/n_{1+}}{n_{11}} + \frac{1-n_{21}/n_{2+}}{n_{21}}  =
\frac{1-139/11037}{139} + \frac{1-239/11034}{239} = 0.011 $$

상대위험의 신뢰구간은 다음과 같다.

$$(0.581 \times \exp[-1.96\sqrt{0.011}], 0.581 \times \exp[1.96\sqrt{0.011}])
= ( 0.473, 0.715)$$

위의 신뢰구간은 1을 포함하지 않으므로 상대위험이 1 과 유의한 차이가 있다고 할 수 있다.
결론적으로 아스피린의 복용은 심근경색의 발생을 감소시킨다고 할 수 있다.

이제 `epiR` 패키지를 사용하여 위에서 분석한 내용을 다시 구해보자.

먼저 위의 임상실험 자료를 `R` 의 `matrix` 형태로 저장한다.

```{r}
ex1dat <- matrix( c(139, 10898, 239, 10795), 2, 2, byrow=TRUE)
ex1dat
```


이제 함수 `epi.2by2`를 이용하여 상대위험과 싱대구간을 구해보자. 임의화를 사용한 임상실험 자료인 경우 `method = "cross.sectional"` 으로 지정한다. 관심이 있는 사건(심근경색, outcome)의 도수가 첫 번째 열(column)에 있으니  `outcome = "as.columns"`이라고 지정한다.


아래 결과에 `Prevalence ratio`라고 나오는 것이 상대위험이다.

```{r}
epi.2by2(dat = ex1dat, method = "cross.sectional", conf.level = 0.95, units = 100, 
   interpret = FALSE, outcome = "as.columns")
```
                  

## 사례-대조 연구 {#casecontrol}


심장발작을 일으킨 환자와 그렇지 않은 사람들을 각각 214명씩 조사하여 과거에 약물남용을 한 경력이 있는지 조사한 사례-대조 연구의 자료이다.

|  |  심장 발작 발생 |   심장발작 없음    | 
|:---------------:|:---------:|:-----------:|
|  약물남용 유  | $73$ |   $18$  |
|  약물남용 무  | $141$|   $196$ |
|  합  | 214 | 214 | 

: 약물 남용 사례-대조 연구 결과 {#tbl-conttable26} 

이 연구의 목표는 약물남용과 심장발작의 연관성이 있는지를 알아보는 것이다.  이제 다음과 같은 사건들을 정의해 보자.


- $H+$: 심장발작이 발생했다.
- $H-$: 심장발작이 발생하지 않았다.
- $D+$: 약물남용을 했다.
- $D-$: 약물남용을 하지 않았다.


위에서 정의된 사건들을 고려할 때 사례-대조 연구의 자료에서 다음과 같은 조건부 확률에 대한 추정값을 구할 수 있다.

\begin{align*}
 P(\textrm{약물남용을 했다} | \textrm{심장발작이 발생했다}) & =P(D+|H+) = \frac{73}{214} \\
 P(\textrm{약물남용을 하지 않았다} | \textrm{심장발작이 발생했다}) & =P(D-|H+) = 1- P(D+|H+) = \frac{141}{214} \\
  & \\
 P(\textrm{약물남용을 했다} | \textrm{심장발작이 발생하지 않았다}) & =P(D+|H-) = \frac{18}{214} \\
  P(\textrm{약물남용을 하지 않았다} | \textrm{심장발작이 발생하지 않았다}) & =P(D-|H-) = 1- P(D+|H-) = \frac{196}{214} 
\end{align*}

### 사례대조 연구의 목표와 가설


연구에서 비교하고 싶은 비율은 위에서 추정한 확률이 아니고 조건과 결과가 바뀐 다음과 같은 조건부 확률이다.
\begin{align*}
P( \textrm{심장발작이 발생했다} | \textrm{약물남용을 했다} ) & = P(H+|D+) \\
P( \textrm{심장발작이 발생했다} | \textrm{약물남용을 하지 않았다} ) & = P(H+|D-) \\
\end{align*}

즉 연구의 목표는 다음과 같은 가설을 검정하는 것이다. 

$$
 H_0: P(H+|D+) = P(H+|D-)  ~~~\text{ vs } ~~~H_1: P(H+|D+) \ne P(H+|D-) 
$$ {#eq-hypo01}


전체 모집단을 약물남용을 한 사람들과 하지 않은 사람들로 두 집단으로 나누었을 때 두 집단에 대한 심장발작의 확률이 같은지 다른지 비교하고 싶은 것이다.

위의 식에서 보듯이 추정하고  싶은 확률인  $P(H+|D+)$와 $P(H+|D-)$를 추정하려면 전체 모집단에 대한 심장발작 발병률 $P(H+)$와 약물남용의 비율 $P(D+)$를 알아야 한다. 즉

\begin{align*}
P(H+|D+) & = \frac{ P(H+ \cap D+)} { P(D+)} \\
          & = \frac{ P(D+|H+) P(H+)} { P(D+)} \\
          & \approx  (73/214) \frac{ P(H+)} { P(D+)} \\
\end{align*}

위의 식은 다음의 조건부 확률 공식을 각 단계마다 적용한 결과이다.

$$ P(A \cap B) = P(A|B)P(B) = P(B|A) P(A) $$


 사례-대조 연구의 자료만으로는 모집단에 대한 심장발작 발병률 $P(H+)$와 약물남용의 비율 $P(D+)$을 구할 수 없다. 또한  다른 외부의 자료가 있다 하더라도 약물남용의 비율을 정확하게 추정하는 것은 매우 어렵다.


### 오즈비의 비교

이러한 문제는 두 집단의 비율의 차이나 상대위험을 비교하지 않고 오즈비를 구하여 비교하면  심장발작 발병률와 약물남용의 비율을 추정하지 않고 사례-대조 연구의 자료만으로 추론이 가능하다. 

다음의 가설은 두 비율의 비교를 오즈비로 표현한 것이다.

$$
 H_0: \frac{P(H+|D+)/P(H-|D+)}{P(H+|D-) / P(H-|D-)} =1  ~~~\text{ vs } ~~~H_1: 
 \frac{P(H+|D+)/P(H-|D+)}{P(H+|D-) / P(H-|D-)} \ne 1
$$ {#eq-hypo02}

위의 가설 @eq-hypo02 는 단순한 비율을 비교하는 가설 @eq-hypo01 과 동일한 가설이다. 

가설 @eq-hypo02 에서 나타는 오즈비는 심장발작 발병률와 약물남용의 비율을 이용하지 않고 사례-대조 연구에서 추정할 수 있는 조건부 확률만으로  추정할 수 있다.

\begin{align*}
\frac{P(H+|D+)/P(H-|D+)}{P(H+|D-) / P(H-|D-)}  
   & =  \frac{[P(H+|D+)P(D+)]/[P(H-|D+)P(D+)]}{[P(H+|D-)P(D-)] / [P(H-|D-)P(D-)]} \\
   & =  \frac{P(H+ \cap D+)/P(H- \cap D+)}{P(H+ \cap D-) / P(H- \cap D-)}\\
   & =  \frac{[P(D+|H+)P(H+)]/ [P(D+|H-) P(H-)]} {[P( D-|H+)P(H+)] / [P(D-|H-)P(H-)]}\\
   & =  \frac{P(D+|H+)/ P(D+|H-)} {P( D-|H+) / P(D-|H-)} \\
   &=   \frac{(73/214)/ (142/214)} {(18/214)/ (196/214)} \\
   & = \frac{(73)(196)}{(141)(18)} \\
   & = 5.64
\end{align*}


결론적으로 사례-대조 연구에서는 연구의 목표에 대한 가설 검정을 비율의 차이나 상대위험으로 표현하여 수행할 수 없다. 하지만 오즈비를 검정하는 것으로 가설을 세우면 자료에서 쉽게 유도할 수 있는 오즈비로 가설 검정을 쉽게 수행할 수 있다.


### 예제: 약물남용 사례-대조 연구 

심작발작을 일으킨 환자와 그렇지 않은 사람들을 각각 214명씩 조사하여 과거에 약물남용을 한 경력이 있느지 조사한 **사례-대조 연구(case-control study)** 의 결과가 표 @tbl-conttable26 에 있다.

사례-대조 연구는 사례(case)가 발견되면, 즉 위의 연구와 같이 심장발작이 일어난 환자가
발생하면 그 환자와 유사한 나이와 성별 등을 가진 일반사람을 찾아 매칭하여 환자와 일반인의 과거 경력을 조사하는 후향적인 연구(restrspective study)이다. 반대로 앞의 예제에서 본 임의화를 이용한 임상실험은 전향적 연구(prospective study)이다.

이러한 사례-대조 연구에서는 상대위험을 이용하여 연관성을 알아낼 수 없다. 
하지만 사례-대조 연구에서 상대위험 대신 오즈비를 이용하여 연관성을 추론할 수 있다. 


위의 심장발작에 대한 사례-대조 연구의 결과에서 오즈비와 그 신뢰구간을 구해보자. 


먼저 오즈비는 다음과 같다. 

$$ OR = \frac{(73)(196)}{(18)(141)} = 5.64 $$


위의 결과는 심장발작이 일어난 집단에서 약물남용을 한 환자들의 오즈가  심장발작이 일어나지 않은 집단에서 약물남용을 한 사람들의 오즈에 비해 5.6배 크다는 것을 알 수 있으며 이는 1보다 상당히 크다.

오즈비의 95\% 근사 신뢰구간은 다음과 같이 계산한다.

먼저 다음 $v_1$ 를 계산하면  

$$ v_1 =V ( \log OR)   \approx \frac{1}{n_{11}} + \frac{1}{n_{12}} + \frac{1}{n_{21}} + \frac{1}{n_{22}} = \frac{1}{73} + \frac{1}{18} + \frac{1}{141} + \frac{1}{196} =0.08$$

오즈비의 신뢰구간은 다음과 같다.

$$(5.64 \times \exp[-1.96\sqrt{0.08}], 5.64 \times \exp[1.96\sqrt{0.08}])
= (3.222, 9.863)$$

위의 신뢰구간을 보면 1을 포함하지 않으므로 약물남용이 심장발작의 위험을 높인다고 말할 수 있다. 


이제 `epiR` 패키지를 사용하여 위에서 분석한 내용을 다시 구해보자.

먼저 위의 사례-대조 연구 자료를 `R` 의 `matrix` 형태로 저장한다.

```{r}
ex2dat <- matrix( c(73,18,141,196), 2, 2, byrow=TRUE)
ex2dat
```
   
   
   
이제 함수 `epi.2by2`를 이용하여 오즈비과 신뢰구간을 구해보자. 사례-대조 연구의 자료인 경우 `method = "case.control"` 으로 저장한다. 사례-대조 연구로 지정하면 상대위험이 출력되지 않는다.  관심이 있는 사건(심장발작, outcome)의 도수가 첫 번째 열(column)에 있으니  `outcome = "as.columns"`이라고 지정한다. 
               
```{r}
epi.2by2(dat = ex2dat, method = "case.control", conf.level = 0.95, units = 100, 
   interpret = FALSE, outcome = "as.columns")
```

